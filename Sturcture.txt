dex-v3/
â”‚
â”œâ”€â”€ contracts/      # All onâ€‘chain code
â”‚   â”œâ”€â”€ core/      # â€œKernelâ€ pools & factory
â”‚   â”‚   â”œâ”€â”€ Factory.sol
â”‚   â”‚   â”œâ”€â”€ Pool.sol
â”‚   â”‚   â”œâ”€â”€ PoolDeployer.sol
â”‚   â”‚   â””â”€â”€ interfaces/
â”‚   â”‚       â”œâ”€â”€ IPool.sol
â”‚   â”‚       â”œâ”€â”€ IFactory.sol
â”‚   â”‚       â””â”€â”€ callback/
â”‚   â”‚           â””â”€â”€ IUniswapV3SwapCallback.sol
â”‚   â”‚
â”‚   â”œâ”€â”€ libraries/               # Pure/â€‘view math & helpers
â”‚   â”‚   â”œâ”€â”€ TickMath.sol
â”‚   â”‚   â”œâ”€â”€ FullMath.sol
â”‚   â”‚   â”œâ”€â”€ FixedPoint128.sol
â”‚   â”‚   â”œâ”€â”€ LiquidityMath.sol
â”‚   â”‚   â”œâ”€â”€ FeeMath.sol
â”‚   â”‚   â”œâ”€â”€ OracleMath.sol
â”‚   â”‚   â”œâ”€â”€ BitMath.sol
â”‚   â”‚   â””â”€â”€ SafeCast.sol
â”‚   â”‚
â”‚   â”œâ”€â”€ periphery/               # UX helpers, routers, position NFTs
â”‚   â”‚   â”œâ”€â”€ SwapRouter.sol
â”‚   â”‚   â”œâ”€â”€ NonfungiblePositionManager.sol
â”‚   â”‚   â”œâ”€â”€ Quoter.sol
â”‚   â”‚   â”œâ”€â”€ Multicall.sol
â”‚   â”‚   â””â”€â”€ interfaces/
â”‚   â”‚       â””â”€â”€ ISwapRouter.sol
â”‚   â”‚
â”‚   â”œâ”€â”€ governance/              # Protocol controls & fee capture
â”‚   â”‚   â”œâ”€â”€ ProtocolFees.sol
â”‚   â”‚   â”œâ”€â”€ EmergencyPause.sol
â”‚   â”‚   â””â”€â”€ TimelockController.sol
â”‚   â”‚
â”‚   â”œâ”€â”€ mocks/                   # Lightweight stubs for testing
â”‚   â”‚   â”œâ”€â”€ ERC20Mock.sol
â”‚   â”‚   â”œâ”€â”€ WETH9Mock.sol
â”‚   â”‚   â””â”€â”€ CallbackTargetMock.sol
â”‚   â”‚
â”‚   â””â”€â”€ upgradeability/          # Optional proxies (if chosen)
â”‚       â”œâ”€â”€ TransparentProxy.sol
â”‚       â””â”€â”€ ProxyAdmin.sol
â”‚
â”œâ”€â”€ script/                       # Foundry / Hardhat runtime scripts
â”‚   â”œâ”€â”€ Deploy.s.sol              # forge script to deploy factory & router
â”‚   â”œâ”€â”€ CreatePool.s.sol          # quick pool factory helper
â”‚   â””â”€â”€ SimulateSwap.s.sol        # repeatable swap scenarios
â”‚
â”œâ”€â”€ test/                         # Unit & invariant tests
â”‚   â”œâ”€â”€ libraries/
â”‚   â”‚   â”œâ”€â”€ TickMath.t.sol
â”‚   â”‚   â””â”€â”€ FullMath.t.sol
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ Pool.t.sol
â”‚   â”‚   â””â”€â”€ Factory.t.sol
â”‚   â”œâ”€â”€ periphery/
â”‚   â”‚   â”œâ”€â”€ SwapRouter.t.sol
â”‚   â”‚   â””â”€â”€ PositionManager.t.sol
â”‚   â””â”€â”€ fuzz/
â”‚       â””â”€â”€ Invariants.t.sol
â”‚
â”œâ”€â”€ .forgeâ€‘snapshot/              # (autoâ€‘generated) Foundry state diffs
â”‚
â”œâ”€â”€ deployments/                  # JSON artifacts per network (if using Hardhatâ€‘deploy)
â”‚   â”œâ”€â”€ mainnet/
â”‚   â””â”€â”€ sepolia/
â”‚
â”œâ”€â”€ abi/                          # Cleaned ABIs for frontâ€‘end consumption
â”‚   â”œâ”€â”€ Pool.json
â”‚   â””â”€â”€ SwapRouter.json
â”‚
â”œâ”€â”€ scripts/                      # Node/TypeScript helpers (nonâ€‘onâ€‘chain)
â”‚   â”œâ”€â”€ generateAbi.ts
â”‚   â””â”€â”€ encodeMulticall.ts
â”‚
â”œâ”€â”€ docs/                         # Architecture notes & specs
â”‚   â”œâ”€â”€ AMM_Math.md
â”‚   â”œâ”€â”€ UpgradeStrategy.md
â”‚   â””â”€â”€ SecurityReview.md
â”‚
â”œâ”€â”€ .github/
â”‚   â”œâ”€â”€ workflows/
â”‚   â”‚   â””â”€â”€ ci.yml               # Lint + test on push
â”‚   â””â”€â”€ ISSUE_TEMPLATE.md
â”‚
â”œâ”€â”€ foundry.toml                  # Foundry config
â”œâ”€â”€ hardhat.config.ts             # (optional) Hardhat config
â”œâ”€â”€ package.json                  # npm scripts for tooling
â”œâ”€â”€ README.md
â””â”€â”€ LICENSE




// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

import "forge-std/Script.sol";
import {Factory} from "../src/core/Factory.sol";
import {PoolDeployer} from "../src/core/PoolDeployer.sol";
import {ProtocolFee} from "../src/governance/ProtocolFee.sol";
import {SwapRouter} from "../src/periphery/SwapRouter.sol";
import {NonfungiblePositionManager} from "../src/periphery/NonfungiblePositionManager.sol";
import {WrappedNative} from "../src/mock/WrappedNative.sol";

contract DeploySupaSwap is Script {
    function run() external {
        address deployer = msg.sender;

        vm.startBroadcast();

        // Deploy core governance
        ProtocolFee protocolFee = new ProtocolFee(deployer);

        // Deploy PoolDeployer and Factory
        PoolDeployer poolDeployer = new PoolDeployer();
        Factory factory = new Factory(address(poolDeployer), address(protocolFee));

        // Set factory in pool deployer
        poolDeployer.setFactory(address(factory));

        // Deploy wrapped native token (e.g., WETH or WMONAD)
        WrappedNative wrappedNative = new WrappedNative();

        // Deploy Router
        SwapRouter router = new SwapRouter(address(factory), address(wrappedNative));

        // Deploy Position Manager
        NonfungiblePositionManager nftManager = new NonfungiblePositionManager(
            address(factory),
            address(wrappedNative)
        );

        vm.stopBroadcast();

        console.log("ğŸ“¦ Protocol Deployment Complete");
        console.log("Factory:", address(factory));
        console.log("PoolDeployer:", address(poolDeployer));
        console.log("ProtocolFee:", address(protocolFee));
        console.log("SwapRouter:", address(router));
        console.log("PositionManager (NFT):", address(nftManager));
        console.log("WrappedNative:", address(wrappedNative));
    }
}
